{"version":3,"file":"index.js","sources":["src/sw-register.js","src/isgd.js","src/menu.js","src/url-params.js","src/index.js"],"sourcesContent":["if (location.protocol === 'http:') location.protocol = 'https:'\nif ('serviceWorker' in navigator) {\n  navigator.serviceWorker.register('sw.js')\n    .then(reg => console.log('Service Worker registered', reg))\n    .catch(err => console.error('Service Worker **not** registered', err))\n} else {\n  console.warn('Service Worker not supported in this browser')\n}\n","export const shortenUrl = url =>\n  fetch('https://is.gd/create.php?format=json&url=' + encodeURIComponent(url))\n    .then(res => res.json())\n    .then(({shorturl}) => shorturl)\n\nexport const lookupUrl = shorturl =>\n  fetch('https://is.gd/forward.php?format=json&shorturl=' + encodeURIComponent(shorturl))\n    .then(res => res.json())\n    .then(({url}) => url)\n","import { shortenUrl } from './isgd.js'\nimport { getSlug } from './url-params.js'\n\nexport let updateKey, makeKeyStale, spin\n\nexport default () => {\n  const $html = document.querySelector('html')\n\n  const $main = document.querySelector('main')\n\n  const $more = document.querySelector('aside .more')\n  const $aside = document.querySelector('aside')\n  const $menu = $aside.querySelector('.menu')\n  $menu.querySelector('.overlay').addEventListener('click', () => {\n    $menu.classList.add('hide')\n  })\n  $more.addEventListener('click', () => {\n    $menu.classList.remove('hide')\n  })\n\n  const $color = $menu.querySelector('.color')\n  const $colors = Array.from($color.children)\n  let colorIndex = 1\n  $color.addEventListener('click', () => {\n    $html.dataset.color = $colors[colorIndex].dataset.color\n    $colors[colorIndex].classList.add('hide')\n    colorIndex = ++colorIndex % $colors.length\n    $colors[colorIndex].classList.remove('hide')\n  })\n\n  const $script = $menu.querySelector('.script')\n  const $scripts = Array.from($script.children)\n  let scriptIndex = 1\n  $script.addEventListener('click', () => {\n    $main.dataset.script = $scripts[scriptIndex].dataset.script\n    $scripts[scriptIndex].classList.add('hide')\n    scriptIndex = ++scriptIndex % $scripts.length\n    $scripts[scriptIndex].classList.remove('hide')\n  })\n\n  const $save = $menu.querySelector('.save')\n  const $shortUrl = $save.querySelector('.label')\n  const $floppy = $save.querySelector('.floppy')\n  const $spinner = $save.querySelector('.spinner')\n  const $share = $save.querySelector('.share')\n  const $copy = $save.querySelector('.copy')\n  let fresh = false\n  let key = ''\n  updateKey = k => {\n    fresh = true\n    key = k\n    $shortUrl.innerHTML = key\n    const params = new window.URLSearchParams(window.location.search)\n    params.set('s', key)\n    params.delete('t')\n    window.history.pushState({}, '', window.location.pathname + '?' + params)\n    $floppy.classList.add('hide')\n    $spinner.classList.add('hide')\n    $share.classList.add('hide')\n    $copy.classList.add('hide')\n    if (navigator.share) $share.classList.remove('hide')\n    else $copy.classList.remove('hide')\n    $more.classList.remove('error')\n    $more.classList.remove('warning')\n    $more.classList.add('okay')\n  }\n  makeKeyStale = () => {\n    fresh = false\n    $floppy.classList.remove('hide')\n    $spinner.classList.add('hide')\n    $share.classList.add('hide')\n    $copy.classList.add('hide')\n    $more.classList.remove('error')\n    $more.classList.remove('warning')\n    $more.classList.remove('okay')\n  }\n  spin = () => {\n    $floppy.classList.add('hide')\n    $spinner.classList.remove('hide')\n    $share.classList.add('hide')\n    $copy.classList.add('hide')\n    $more.classList.remove('error')\n    $more.classList.add('warning')\n    $more.classList.remove('okay')\n  }\n  $save.addEventListener('click', async () => {\n    if (!fresh) {\n      spin()\n      const shortUrl = await shortenUrl(window.location.href)\n      key = new URL(shortUrl).pathname.slice(1)\n      updateKey(key)\n    } else {\n      if (navigator.share) {\n        navigator.share({\n          title: 'sitelen-pona',\n          text: getSlug(),\n          url: window.location.href,\n        })\n          .then(() => console.log('Successful share'))\n          .catch((error) => console.log('Error sharing', error))\n      } else {\n        const dummy = document.createElement('textarea')\n        dummy.value = window.location.href\n        document.body.appendChild(dummy)\n        dummy.select()\n        document.execCommand('copy')\n        document.body.removeChild(dummy)\n      }\n    }\n  })\n\n  const $about = $menu.querySelector('.about')\n  const $abountContent = $aside.querySelector('.about-content')\n  $about.addEventListener('click', () => $abountContent.classList.remove('hide'))\n  $abountContent.querySelector('.overlay').addEventListener('click', () => $abountContent.classList.add('hide'))\n}\n","import { lookupUrl } from './isgd.js'\nimport { updateKey, makeKeyStale, spin } from './menu.js'\n\nexport let getSlug\n\nexport default () => {\n  const params = new window.URLSearchParams(window.location.search)\n  const content = document.querySelector('main')\n\n  // Load content from URL, if any.\n  const load = async function () {\n    let text = params.get('t')\n    const key = params.get('s')\n    if (key) {\n      spin()\n      text = new URLSearchParams(new URL(await lookupUrl('https://is.gd/' + key)).search).get('t')\n      params.delete('s')\n      params.set('t', new URLSearchParams(new URL(await lookupUrl('https://is.gd/' + key)).search).get('t'))\n      window.history.pushState({}, '', window.location.pathname + '?' + params)\n      updateKey(key)\n    }\n    content.innerHTML = text || 'toki!'\n    title()\n  }\n  // Save content to the URL.\n  const save = function () {\n    params.set('t', content.innerHTML // Replace div soup with newlines.\n      .replace(/<div>/g, '\\n')\n      .replace(/<\\/?(div|br)>/g, '')\n    )\n    window.history.replaceState({}, '', window.location.pathname + '?' + params)\n    makeKeyStale()\n  }\n  // Update title from content.\n  getSlug = () => {\n    for (let line of content.innerHTML.split('<br>')) {\n      if (line) {\n        return line.replace(/<[a-z0-9-]+>/g, '')\n      }\n    }\n  }\n  const title = function () {\n    document.title = 'isipo - ' + getSlug()\n  }\n  // Place caret at the end of content.\n  const focus = function () {\n    if (!content.innerHTML.trim().replace('<br>', '')) {\n      setTimeout(function () { content.focus() }, 0)\n    } else {\n      content.focus()\n      let range = document.createRange()\n      range.selectNodeContents(content)\n      range.collapse(false)\n      let sel = window.getSelection()\n      sel.removeAllRanges()\n      sel.addRange(range)\n    }\n  }\n\n  // Hook up save routine.\n  let cooldown = false\n  content.oninput = function () {\n    if (!cooldown) {\n      setTimeout(\n        function () {\n          save()\n          title()\n          cooldown = false\n        },\n        1 * 1000\n      )\n    }\n    cooldown = true\n  }\n\n  // Override keys.\n  document.onkeydown = function (e) {\n    switch (e.keyCode) {\n      case 9: // Let tabs be tabs~\n      // TODO: Consider `document.execCommand('indent')` and `outdent`\n        document.execCommand('insertHTML', false, '&#9')\n        e.preventDefault()\n        break\n    }\n  }\n\n  // Initialize.\n  load()\n  focus()\n}\n","import './sw-register.js'\nimport setupUrlSaving from './url-params.js'\nimport setupMenu from './menu.js'\n\ndocument.onreadystatechange = function () {\n  if (document.readyState === 'interactive' || document.readyState === 'complete') {\n    document.onreadystatechange = () => {}\n    setupMenu()\n    setupUrlSaving()\n  }\n}\n"],"names":["location","protocol","navigator","serviceWorker","register","then","reg","console","log","catch","err","error","warn","shortenUrl","url","fetch","encodeURIComponent","res","json","shorturl","lookupUrl","updateKey","makeKeyStale","spin","$html","document","querySelector","$main","$more","$aside","$menu","addEventListener","classList","add","remove","$color","$colors","Array","from","children","colorIndex","dataset","color","length","$script","$scripts","scriptIndex","script","$save","$shortUrl","$floppy","$spinner","$share","$copy","fresh","key","k","innerHTML","params","window","URLSearchParams","search","set","delete","history","pushState","pathname","share","shortUrl","href","URL","slice","getSlug","dummy","createElement","value","body","appendChild","select","execCommand","removeChild","$about","$abountContent","content","load","text","get","save","replace","replaceState","line","split","title","focus","trim","range","createRange","selectNodeContents","collapse","sel","getSelection","removeAllRanges","addRange","cooldown","oninput","onkeydown","e","keyCode","preventDefault","onreadystatechange","readyState"],"mappings":"AAAA,IAAIA,SAASC,QAAT,KAAsB,OAA1B,EAAmCD,SAASC,QAAT,GAAoB,QAApB;AACnC,IAAI,mBAAmBC,SAAvB,EAAkC;YACtBC,aAAV,CAAwBC,QAAxB,CAAiC,OAAjC,EACGC,IADH,CACQC,OAAOC,QAAQC,GAAR,CAAY,2BAAZ,EAAyCF,GAAzC,CADf,EAEGG,KAFH,CAESC,OAAOH,QAAQI,KAAR,CAAc,mCAAd,EAAmDD,GAAnD,CAFhB;CADF,MAIO;UACGE,IAAR,CAAa,8CAAb;;;ACNK,MAAMC,aAAaC,OACxBC,MAAM,8CAA8CC,mBAAmBF,GAAnB,CAApD,EACGT,IADH,CACQY,OAAOA,IAAIC,IAAJ,EADf,EAEGb,IAFH,CAEQ,CAAC,EAACc,QAAD,EAAD,KAAgBA,QAFxB,CADK;;AAKP,AAAO,MAAMC,YAAYD,YACvBJ,MAAM,oDAAoDC,mBAAmBG,QAAnB,CAA1D,EACGd,IADH,CACQY,OAAOA,IAAIC,IAAJ,EADf,EAEGb,IAFH,CAEQ,CAAC,EAACS,GAAD,EAAD,KAAWA,GAFnB,CADK;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACFA,IAAIO,SAAJ;IAAeC,YAAf;IAA6BC,IAA7B;;AAEP,iBAAe,MAAM;QACbC,QAAQC,SAASC,aAAT,CAAuB,MAAvB,CAAd;;QAEMC,QAAQF,SAASC,aAAT,CAAuB,MAAvB,CAAd;;QAEME,QAAQH,SAASC,aAAT,CAAuB,aAAvB,CAAd;QACMG,SAASJ,SAASC,aAAT,CAAuB,OAAvB,CAAf;QACMI,QAAQD,OAAOH,aAAP,CAAqB,OAArB,CAAd;QACMA,aAAN,CAAoB,UAApB,EAAgCK,gBAAhC,CAAiD,OAAjD,EAA0D,MAAM;UACxDC,SAAN,CAAgBC,GAAhB,CAAoB,MAApB;GADF;QAGMF,gBAAN,CAAuB,OAAvB,EAAgC,MAAM;UAC9BC,SAAN,CAAgBE,MAAhB,CAAuB,MAAvB;GADF;;QAIMC,SAASL,MAAMJ,aAAN,CAAoB,QAApB,CAAf;QACMU,UAAUC,MAAMC,IAAN,CAAWH,OAAOI,QAAlB,CAAhB;MACIC,aAAa,CAAjB;SACOT,gBAAP,CAAwB,OAAxB,EAAiC,MAAM;UAC/BU,OAAN,CAAcC,KAAd,GAAsBN,QAAQI,UAAR,EAAoBC,OAApB,CAA4BC,KAAlD;YACQF,UAAR,EAAoBR,SAApB,CAA8BC,GAA9B,CAAkC,MAAlC;iBACa,EAAEO,UAAF,GAAeJ,QAAQO,MAApC;YACQH,UAAR,EAAoBR,SAApB,CAA8BE,MAA9B,CAAqC,MAArC;GAJF;;QAOMU,UAAUd,MAAMJ,aAAN,CAAoB,SAApB,CAAhB;QACMmB,WAAWR,MAAMC,IAAN,CAAWM,QAAQL,QAAnB,CAAjB;MACIO,cAAc,CAAlB;UACQf,gBAAR,CAAyB,OAAzB,EAAkC,MAAM;UAChCU,OAAN,CAAcM,MAAd,GAAuBF,SAASC,WAAT,EAAsBL,OAAtB,CAA8BM,MAArD;aACSD,WAAT,EAAsBd,SAAtB,CAAgCC,GAAhC,CAAoC,MAApC;kBACc,EAAEa,WAAF,GAAgBD,SAASF,MAAvC;aACSG,WAAT,EAAsBd,SAAtB,CAAgCE,MAAhC,CAAuC,MAAvC;GAJF;;QAOMc,QAAQlB,MAAMJ,aAAN,CAAoB,OAApB,CAAd;QACMuB,YAAYD,MAAMtB,aAAN,CAAoB,QAApB,CAAlB;QACMwB,UAAUF,MAAMtB,aAAN,CAAoB,SAApB,CAAhB;QACMyB,WAAWH,MAAMtB,aAAN,CAAoB,UAApB,CAAjB;QACM0B,SAASJ,MAAMtB,aAAN,CAAoB,QAApB,CAAf;QACM2B,QAAQL,MAAMtB,aAAN,CAAoB,OAApB,CAAd;MACI4B,QAAQ,KAAZ;MACIC,MAAM,EAAV;cACYC,KAAK;YACP,IAAR;UACMA,CAAN;cACUC,SAAV,GAAsBF,GAAtB;UACMG,SAAS,IAAIC,OAAOC,eAAX,CAA2BD,OAAO3D,QAAP,CAAgB6D,MAA3C,CAAf;WACOC,GAAP,CAAW,GAAX,EAAgBP,GAAhB;WACOQ,MAAP,CAAc,GAAd;WACOC,OAAP,CAAeC,SAAf,CAAyB,EAAzB,EAA6B,EAA7B,EAAiCN,OAAO3D,QAAP,CAAgBkE,QAAhB,GAA2B,GAA3B,GAAiCR,MAAlE;YACQ1B,SAAR,CAAkBC,GAAlB,CAAsB,MAAtB;aACSD,SAAT,CAAmBC,GAAnB,CAAuB,MAAvB;WACOD,SAAP,CAAiBC,GAAjB,CAAqB,MAArB;UACMD,SAAN,CAAgBC,GAAhB,CAAoB,MAApB;QACI/B,UAAUiE,KAAd,EAAqBf,OAAOpB,SAAP,CAAiBE,MAAjB,CAAwB,MAAxB,EAArB,KACKmB,MAAMrB,SAAN,CAAgBE,MAAhB,CAAuB,MAAvB;UACCF,SAAN,CAAgBE,MAAhB,CAAuB,OAAvB;UACMF,SAAN,CAAgBE,MAAhB,CAAuB,SAAvB;UACMF,SAAN,CAAgBC,GAAhB,CAAoB,MAApB;GAhBF;iBAkBe,MAAM;YACX,KAAR;YACQD,SAAR,CAAkBE,MAAlB,CAAyB,MAAzB;aACSF,SAAT,CAAmBC,GAAnB,CAAuB,MAAvB;WACOD,SAAP,CAAiBC,GAAjB,CAAqB,MAArB;UACMD,SAAN,CAAgBC,GAAhB,CAAoB,MAApB;UACMD,SAAN,CAAgBE,MAAhB,CAAuB,OAAvB;UACMF,SAAN,CAAgBE,MAAhB,CAAuB,SAAvB;UACMF,SAAN,CAAgBE,MAAhB,CAAuB,MAAvB;GARF;SAUO,MAAM;YACHF,SAAR,CAAkBC,GAAlB,CAAsB,MAAtB;aACSD,SAAT,CAAmBE,MAAnB,CAA0B,MAA1B;WACOF,SAAP,CAAiBC,GAAjB,CAAqB,MAArB;UACMD,SAAN,CAAgBC,GAAhB,CAAoB,MAApB;UACMD,SAAN,CAAgBE,MAAhB,CAAuB,OAAvB;UACMF,SAAN,CAAgBC,GAAhB,CAAoB,SAApB;UACMD,SAAN,CAAgBE,MAAhB,CAAuB,MAAvB;GAPF;QASMH,gBAAN,CAAuB,OAAvB,mBAAgC,aAAY;QACtC,CAACuB,KAAL,EAAY;;YAEJc,WAAW,MAAMvD,WAAW8C,OAAO3D,QAAP,CAAgBqE,IAA3B,CAAvB;YACM,IAAIC,GAAJ,CAAQF,QAAR,EAAkBF,QAAlB,CAA2BK,KAA3B,CAAiC,CAAjC,CAAN;gBACUhB,GAAV;KAJF,MAKO;UACDrD,UAAUiE,KAAd,EAAqB;kBACTA,KAAV,CAAgB;iBACP,cADO;gBAERK,SAFQ;eAGTb,OAAO3D,QAAP,CAAgBqE;SAHvB,EAKGhE,IALH,CAKQ;iBAAME,QAAQC,GAAR,CAAY,kBAAZ,CAAN;SALR,EAMGC,KANH,CAMS,UAACE,KAAD;iBAAWJ,QAAQC,GAAR,CAAY,eAAZ,EAA6BG,KAA7B,CAAX;SANT;OADF,MAQO;cACC8D,QAAQhD,SAASiD,aAAT,CAAuB,UAAvB,CAAd;cACMC,KAAN,GAAchB,OAAO3D,QAAP,CAAgBqE,IAA9B;iBACSO,IAAT,CAAcC,WAAd,CAA0BJ,KAA1B;cACMK,MAAN;iBACSC,WAAT,CAAqB,MAArB;iBACSH,IAAT,CAAcI,WAAd,CAA0BP,KAA1B;;;GArBN;;QA0BMQ,SAASnD,MAAMJ,aAAN,CAAoB,QAApB,CAAf;QACMwD,iBAAiBrD,OAAOH,aAAP,CAAqB,gBAArB,CAAvB;SACOK,gBAAP,CAAwB,OAAxB,EAAiC,MAAMmD,eAAelD,SAAf,CAAyBE,MAAzB,CAAgC,MAAhC,CAAvC;iBACeR,aAAf,CAA6B,UAA7B,EAAyCK,gBAAzC,CAA0D,OAA1D,EAAmE,MAAMmD,eAAelD,SAAf,CAAyBC,GAAzB,CAA6B,MAA7B,CAAzE;CA7GF;;ACFO,IAAIuC,OAAJ;;AAEP,sBAAe,MAAM;QACbd,SAAS,IAAIC,OAAOC,eAAX,CAA2BD,OAAO3D,QAAP,CAAgB6D,MAA3C,CAAf;QACMsB,UAAU1D,SAASC,aAAT,CAAuB,MAAvB,CAAhB;;;QAGM0D;gCAAO,aAAkB;UACzBC,OAAO3B,OAAO4B,GAAP,CAAW,GAAX,CAAX;YACM/B,MAAMG,OAAO4B,GAAP,CAAW,GAAX,CAAZ;UACI/B,GAAJ,EAAS;;eAEA,IAAIK,eAAJ,CAAoB,IAAIU,GAAJ,EAAQ,MAAMlD,UAAU,mBAAmBmC,GAA7B,CAAd,GAAiDM,MAArE,EAA6EyB,GAA7E,CAAiF,GAAjF,CAAP;eACOvB,MAAP,CAAc,GAAd;eACOD,GAAP,CAAW,GAAX,EAAgB,IAAIF,eAAJ,CAAoB,IAAIU,GAAJ,EAAQ,MAAMlD,UAAU,mBAAmBmC,GAA7B,CAAd,GAAiDM,MAArE,EAA6EyB,GAA7E,CAAiF,GAAjF,CAAhB;eACOtB,OAAP,CAAeC,SAAf,CAAyB,EAAzB,EAA6B,EAA7B,EAAiCN,OAAO3D,QAAP,CAAgBkE,QAAhB,GAA2B,GAA3B,GAAiCR,MAAlE;kBACUH,GAAV;;cAEME,SAAR,GAAoB4B,QAAQ,OAA5B;;KAXI;;;;;MAAN;;QAeME,OAAO,YAAY;WAChBzB,GAAP,CAAW,GAAX,EAAgBqB,QAAQ1B,SAAR;KACb+B,OADa,CACL,QADK,EACK,IADL,EAEbA,OAFa,CAEL,gBAFK,EAEa,EAFb,CAAhB;WAIOxB,OAAP,CAAeyB,YAAf,CAA4B,EAA5B,EAAgC,EAAhC,EAAoC9B,OAAO3D,QAAP,CAAgBkE,QAAhB,GAA2B,GAA3B,GAAiCR,MAArE;;GALF;;YASU,MAAM;SACT,IAAIgC,IAAT,IAAiBP,QAAQ1B,SAAR,CAAkBkC,KAAlB,CAAwB,MAAxB,CAAjB,EAAkD;UAC5CD,IAAJ,EAAU;eACDA,KAAKF,OAAL,CAAa,eAAb,EAA8B,EAA9B,CAAP;;;GAHN;QAOMI,QAAQ,YAAY;aACfA,KAAT,GAAiB,aAAapB,SAA9B;GADF;;QAIMqB,QAAQ,YAAY;QACpB,CAACV,QAAQ1B,SAAR,CAAkBqC,IAAlB,GAAyBN,OAAzB,CAAiC,MAAjC,EAAyC,EAAzC,CAAL,EAAmD;iBACtC,YAAY;gBAAUK,KAAR;OAAzB,EAA4C,CAA5C;KADF,MAEO;cACGA,KAAR;UACIE,QAAQtE,SAASuE,WAAT,EAAZ;YACMC,kBAAN,CAAyBd,OAAzB;YACMe,QAAN,CAAe,KAAf;UACIC,MAAMxC,OAAOyC,YAAP,EAAV;UACIC,eAAJ;UACIC,QAAJ,CAAaP,KAAb;;GAVJ;;;MAeIQ,WAAW,KAAf;UACQC,OAAR,GAAkB,YAAY;QACxB,CAACD,QAAL,EAAe;iBAEX,YAAY;;;mBAGC,KAAX;OAJJ,EAME,IAAI,IANN;;eASS,IAAX;GAXF;;;WAeSE,SAAT,GAAqB,UAAUC,CAAV,EAAa;YACxBA,EAAEC,OAAV;WACO,CAAL;;;iBAEW5B,WAAT,CAAqB,YAArB,EAAmC,KAAnC,EAA0C,KAA1C;UACE6B,cAAF;;;GALN;;;;;CAvEF;;ACDAnF,SAASoF,kBAAT,GAA8B,YAAY;MACpCpF,SAASqF,UAAT,KAAwB,aAAxB,IAAyCrF,SAASqF,UAAT,KAAwB,UAArE,EAAiF;aACtED,kBAAT,GAA8B,MAAM,EAApC;;;;CAFJ"}