{"version":3,"file":"index.js","sources":["src/sw-register.js","src/index.js"],"sourcesContent":["if (location.protocol === 'http:') location.protocol = 'https:'\nif ('serviceWorker' in navigator) {\n  navigator.serviceWorker.register('sw.js')\n    .then(reg => console.log('Service Worker registered', reg))\n    .catch(err => console.error('Service Worker **not** registered', err))\n} else {\n  console.warn('Service Worker not supported in this browser')\n}\n","import './sw-register.js'\n\ndocument.onreadystatechange = function () {\n  if (document.readyState === 'interactive' || document.readyState === 'complete') {\n    document.onreadystatechange = () => {}\n\n    const params = new window.URLSearchParams(window.location.search)\n    const content = document.querySelector('main')\n\n    // Load content from URL, if any.\n    const load = function () {\n      content.innerHTML = params.get('t') ||\n        'toki!<br>' +\n        'ni li ilo sitelen-pona<br>' +\n        'ni li ilo pi sitelen lon sitelen-pona. ni li sitelen kepeken linja-pona<br>' +\n        'jan [_sitelen_ante_musi_esun] pali ee linja-pona. jan ni li pona mute!'\n    }\n    // Save content to the URL.\n    const save = function () {\n      params.set('t', content.innerHTML)\n      window.history.replaceState({}, '', window.location.pathname + '?' + params)\n    }\n    // Update title from content.\n    const title = function () {\n      for (let line of content.innerHTML.split('<br>')) {\n        if (line) {\n          document.title = 'isipo' + ' - ' + line\n          break\n        }\n      }\n    }\n    // Place caret at the end of content.\n    const focus = function () {\n      if (!content.innerHTML.trim().replace('<br>', '')) {\n        setTimeout(function () { content.focus() }, 0)\n      } else {\n        content.focus()\n        let range = document.createRange()\n        range.selectNodeContents(content)\n        range.collapse(false)\n        let sel = window.getSelection()\n        sel.removeAllRanges()\n        sel.addRange(range)\n      }\n    }\n\n    // Hook up save routine.\n    let cooldown = false\n    content.oninput = function () {\n      if (!cooldown) {\n        setTimeout(\n          function () {\n            save()\n            title()\n            cooldown = false\n          },\n          1 * 1000\n        )\n      }\n      cooldown = true\n    }\n\n    // Override keys.\n    document.onkeydown = function (e) {\n      switch (e.keyCode) {\n        case 9: // Let tabs be tabs~\n          // TODO: Consider indent/outdent for selections with tab/shift+tab.\n          document.execCommand('insertHTML', false, '&#9')\n          e.preventDefault()\n          break\n        case 13: // Override newline to be just `<br>` without wrapping `<div>`s\n          document.execCommand('insertHTML', false, '<br>')\n          e.preventDefault()\n          break\n      }\n    }\n\n    // Initialize.\n    load()\n    title()\n    focus()\n  }\n}\n"],"names":["location","protocol","navigator","serviceWorker","register","then","reg","console","log","catch","err","error","warn","document","onreadystatechange","readyState","params","window","URLSearchParams","search","content","querySelector","load","innerHTML","get","save","set","history","replaceState","pathname","title","line","split","focus","trim","replace","range","createRange","selectNodeContents","collapse","sel","getSelection","removeAllRanges","addRange","cooldown","oninput","onkeydown","e","keyCode","execCommand","preventDefault"],"mappings":"AAAA,IAAIA,SAASC,QAAT,KAAsB,OAA1B,EAAmCD,SAASC,QAAT,GAAoB,QAApB;AACnC,IAAI,mBAAmBC,SAAvB,EAAkC;YACtBC,aAAV,CAAwBC,QAAxB,CAAiC,OAAjC,EACGC,IADH,CACQC,OAAOC,QAAQC,GAAR,CAAY,2BAAZ,EAAyCF,GAAzC,CADf,EAEGG,KAFH,CAESC,OAAOH,QAAQI,KAAR,CAAc,mCAAd,EAAmDD,GAAnD,CAFhB;CADF,MAIO;UACGE,IAAR,CAAa,8CAAb;;;ACJFC,SAASC,kBAAT,GAA8B,YAAY;MACpCD,SAASE,UAAT,KAAwB,aAAxB,IAAyCF,SAASE,UAAT,KAAwB,UAArE,EAAiF;aACtED,kBAAT,GAA8B,MAAM,EAApC;;UAEME,SAAS,IAAIC,OAAOC,eAAX,CAA2BD,OAAOjB,QAAP,CAAgBmB,MAA3C,CAAf;UACMC,UAAUP,SAASQ,aAAT,CAAuB,MAAvB,CAAhB;;;UAGMC,OAAO,YAAY;cACfC,SAAR,GAAoBP,OAAOQ,GAAP,CAAW,GAAX,KAClB,cACA,4BADA,GAEA,6EAFA,GAGA,wEAJF;KADF;;UAQMC,OAAO,YAAY;aAChBC,GAAP,CAAW,GAAX,EAAgBN,QAAQG,SAAxB;aACOI,OAAP,CAAeC,YAAf,CAA4B,EAA5B,EAAgC,EAAhC,EAAoCX,OAAOjB,QAAP,CAAgB6B,QAAhB,GAA2B,GAA3B,GAAiCb,MAArE;KAFF;;UAKMc,QAAQ,YAAY;WACnB,IAAIC,IAAT,IAAiBX,QAAQG,SAAR,CAAkBS,KAAlB,CAAwB,MAAxB,CAAjB,EAAkD;YAC5CD,IAAJ,EAAU;mBACCD,KAAT,GAAiB,UAAU,KAAV,GAAkBC,IAAnC;;;;KAHN;;UASME,QAAQ,YAAY;UACpB,CAACb,QAAQG,SAAR,CAAkBW,IAAlB,GAAyBC,OAAzB,CAAiC,MAAjC,EAAyC,EAAzC,CAAL,EAAmD;mBACtC,YAAY;kBAAUF,KAAR;SAAzB,EAA4C,CAA5C;OADF,MAEO;gBACGA,KAAR;YACIG,QAAQvB,SAASwB,WAAT,EAAZ;cACMC,kBAAN,CAAyBlB,OAAzB;cACMmB,QAAN,CAAe,KAAf;YACIC,MAAMvB,OAAOwB,YAAP,EAAV;YACIC,eAAJ;YACIC,QAAJ,CAAaP,KAAb;;KAVJ;;;QAeIQ,WAAW,KAAf;YACQC,OAAR,GAAkB,YAAY;UACxB,CAACD,QAAL,EAAe;mBAEX,YAAY;;;qBAGC,KAAX;SAJJ,EAME,IAAI,IANN;;iBASS,IAAX;KAXF;;;aAeSE,SAAT,GAAqB,UAAUC,CAAV,EAAa;cACxBA,EAAEC,OAAV;aACO,CAAL;;;mBAEWC,WAAT,CAAqB,YAArB,EAAmC,KAAnC,EAA0C,KAA1C;YACEC,cAAF;;aAEG,EAAL;;mBACWD,WAAT,CAAqB,YAArB,EAAmC,KAAnC,EAA0C,MAA1C;YACEC,cAAF;;;KATN;;;;;;;CA7DJ"}