{"version":3,"file":"index.js","sources":["src/sw-register.js","src/isgd.js","src/setup-menu.js","src/setup-url-saving.js","src/index.js"],"sourcesContent":["if (location.protocol === 'http:') location.protocol = 'https:'\nif ('serviceWorker' in navigator) {\n  navigator.serviceWorker.register('sw.js')\n    .then(reg => console.log('Service Worker registered', reg))\n    .catch(err => console.error('Service Worker **not** registered', err))\n} else {\n  console.warn('Service Worker not supported in this browser')\n}\n","export const shortenUrl = url =>\n  fetch('https://is.gd/create.php?format=json&url=' + encodeURIComponent(url))\n    .then(res => res.json())\n    .then(({shorturl}) => shorturl)\n\nexport const lookupUrl = shorturl =>\n  fetch('https://is.gd/forward.php?format=json&shorturl=' + encodeURIComponent(shorturl))\n    .then(res => res.json())\n    .then(({url}) => url)\n","import { shortenUrl } from './isgd.js'\n\nexport let updateKey, makeKeyStale\n\nexport default () => {\n  const $html = document.querySelector('html')\n\n  const $main = document.querySelector('main')\n\n  const $more = document.querySelector('aside .more')\n  const $aside = document.querySelector('aside')\n  const $menu = $aside.querySelector('.menu')\n  $menu.querySelector('.overlay').addEventListener('pointerdown', () => {\n    $menu.classList.add('hide')\n  })\n  $more.addEventListener('pointerdown', () => {\n    $menu.classList.remove('hide')\n  })\n\n  const $color = $menu.querySelector('.color')\n  const $colors = Array.from($color.children)\n  let colorIndex = 1\n  $color.addEventListener('pointerdown', () => {\n    $html.dataset.color = $colors[colorIndex].dataset.color\n    $colors[colorIndex].classList.add('hide')\n    colorIndex = ++colorIndex % $colors.length\n    $colors[colorIndex].classList.remove('hide')\n  })\n\n  const $script = $menu.querySelector('.script')\n  const $scripts = Array.from($script.children)\n  let scriptIndex = 1\n  $script.addEventListener('pointerdown', () => {\n    $main.dataset.script = $scripts[scriptIndex].dataset.script\n    $scripts[scriptIndex].classList.add('hide')\n    scriptIndex = ++scriptIndex % $scripts.length\n    $scripts[scriptIndex].classList.remove('hide')\n  })\n\n  const $save = $menu.querySelector('.save')\n  const $shortUrl = $save.querySelector('.label')\n  let key = ''\n  updateKey = k => {\n    // TODO: Show share, hide spinner, floppy\n    key = k\n    $shortUrl.innerHTML = key\n    const params = new window.URLSearchParams(window.location.search)\n    params.set('s', key)\n    params.delete('t')\n    window.history.pushState({}, '', window.location.pathname + '?' + params)\n  }\n  makeKeyStale = () => {\n    // TODO: Show floppy, hide share, spinner\n  }\n  $save.addEventListener('pointerdown', async () => {\n    // TODO: Show spinner, hide floppy, share\n    const shortUrl = await shortenUrl(window.location.href)\n    key = new URL(shortUrl).pathname.slice(1)\n    updateKey(key)\n  })\n}\n","import { lookupUrl } from './isgd.js'\nimport { updateKey, makeKeyStale } from './setup-menu.js'\n\nexport default () => {\n  const params = new window.URLSearchParams(window.location.search)\n  const content = document.querySelector('main')\n\n  // Load content from URL, if any.\n  const load = async function () {\n    let text = params.get('t')\n    const key = params.get('s')\n    if (key) {\n      text = new URLSearchParams(new URL(await lookupUrl('https://is.gd/' + key)).search).get('t')\n      params.delete('s')\n      params.set('t', new URLSearchParams(new URL(await lookupUrl('https://is.gd/' + key)).search).get('t'))\n      window.history.pushState({}, '', window.location.pathname + '?' + params)\n      updateKey(key)\n    }\n    content.innerHTML = text ||\n      'toki!<br>' +\n      'ni li ilo sitelen-pona<br>' +\n      'ni li ilo pi sitelen lon sitelen-pona. ni li sitelen kepeken linja-pona<br>' +\n      'jan [_sitelen_ante_musi_esun] pali ee linja-pona. jan ni li pona mute!'\n  }\n  // Save content to the URL.\n  const save = function () {\n    params.set('t', content.innerHTML)\n    window.history.replaceState({}, '', window.location.pathname + '?' + params)\n    makeKeyStale()\n  }\n  // Update title from content.\n  const title = function () {\n    for (let line of content.innerHTML.split('<br>')) {\n      if (line) {\n        document.title = 'isipo' + ' - ' + line.replace(/<[a-z0-9-]+>/g, '')\n        break\n      }\n    }\n  }\n  // Place caret at the end of content.\n  const focus = function () {\n    if (!content.innerHTML.trim().replace('<br>', '')) {\n      setTimeout(function () { content.focus() }, 0)\n    } else {\n      content.focus()\n      let range = document.createRange()\n      range.selectNodeContents(content)\n      range.collapse(false)\n      let sel = window.getSelection()\n      sel.removeAllRanges()\n      sel.addRange(range)\n    }\n  }\n\n  // Hook up save routine.\n  let cooldown = false\n  content.oninput = function () {\n    if (!cooldown) {\n      setTimeout(\n        function () {\n          save()\n          title()\n          cooldown = false\n        },\n        1 * 1000\n      )\n    }\n    cooldown = true\n  }\n\n  // Override keys.\n  document.onkeydown = function (e) {\n    switch (e.keyCode) {\n      case 9: // Let tabs be tabs~\n      // TODO: Consider indent/outdent for selections with tab/shift+tab.\n        document.execCommand('insertHTML', false, '&#9')\n        e.preventDefault()\n        break\n      case 13: // Override newline to be just `<br>` without wrapping `<div>`s\n        document.execCommand('insertHTML', false, '<br><br>')\n        e.preventDefault()\n        break\n    }\n  }\n\n  // Initialize.\n  load()\n  title()\n  focus()\n}\n","import './sw-register.js'\nimport setupUrlSaving from './setup-url-saving.js'\nimport setupMenu from './setup-menu.js'\n\ndocument.onreadystatechange = function () {\n  if (document.readyState === 'interactive' || document.readyState === 'complete') {\n    document.onreadystatechange = () => {}\n    setupUrlSaving()\n    setupMenu()\n  }\n}\n"],"names":["location","protocol","navigator","serviceWorker","register","then","reg","console","log","catch","err","error","warn","shortenUrl","url","fetch","encodeURIComponent","res","json","shorturl","lookupUrl","updateKey","makeKeyStale","$html","document","querySelector","$main","$more","$aside","$menu","addEventListener","classList","add","remove","$color","$colors","Array","from","children","colorIndex","dataset","color","length","$script","$scripts","scriptIndex","script","$save","$shortUrl","key","k","innerHTML","params","window","URLSearchParams","search","set","delete","history","pushState","pathname","shortUrl","href","URL","slice","content","load","text","get","save","replaceState","title","line","split","replace","focus","trim","range","createRange","selectNodeContents","collapse","sel","getSelection","removeAllRanges","addRange","cooldown","oninput","onkeydown","e","keyCode","execCommand","preventDefault","onreadystatechange","readyState"],"mappings":"AAAA,IAAIA,SAASC,QAAT,KAAsB,OAA1B,EAAmCD,SAASC,QAAT,GAAoB,QAApB;AACnC,IAAI,mBAAmBC,SAAvB,EAAkC;YACtBC,aAAV,CAAwBC,QAAxB,CAAiC,OAAjC,EACGC,IADH,CACQC,OAAOC,QAAQC,GAAR,CAAY,2BAAZ,EAAyCF,GAAzC,CADf,EAEGG,KAFH,CAESC,OAAOH,QAAQI,KAAR,CAAc,mCAAd,EAAmDD,GAAnD,CAFhB;CADF,MAIO;UACGE,IAAR,CAAa,8CAAb;;;ACNK,MAAMC,aAAaC,OACxBC,MAAM,8CAA8CC,mBAAmBF,GAAnB,CAApD,EACGT,IADH,CACQY,OAAOA,IAAIC,IAAJ,EADf,EAEGb,IAFH,CAEQ,CAAC,EAACc,QAAD,EAAD,KAAgBA,QAFxB,CADK;;AAKP,AAAO,MAAMC,YAAYD,YACvBJ,MAAM,oDAAoDC,mBAAmBG,QAAnB,CAA1D,EACGd,IADH,CACQY,OAAOA,IAAIC,IAAJ,EADf,EAEGb,IAFH,CAEQ,CAAC,EAACS,GAAD,EAAD,KAAWA,GAFnB,CADK;;;;ACLP,AAEA,AAAO,IAAIO,SAAJ;IAAeC,YAAf;;AAEP,iBAAe,MAAM;QACbC,QAAQC,SAASC,aAAT,CAAuB,MAAvB,CAAd;;QAEMC,QAAQF,SAASC,aAAT,CAAuB,MAAvB,CAAd;;QAEME,QAAQH,SAASC,aAAT,CAAuB,aAAvB,CAAd;QACMG,SAASJ,SAASC,aAAT,CAAuB,OAAvB,CAAf;QACMI,QAAQD,OAAOH,aAAP,CAAqB,OAArB,CAAd;QACMA,aAAN,CAAoB,UAApB,EAAgCK,gBAAhC,CAAiD,aAAjD,EAAgE,MAAM;UAC9DC,SAAN,CAAgBC,GAAhB,CAAoB,MAApB;GADF;QAGMF,gBAAN,CAAuB,aAAvB,EAAsC,MAAM;UACpCC,SAAN,CAAgBE,MAAhB,CAAuB,MAAvB;GADF;;QAIMC,SAASL,MAAMJ,aAAN,CAAoB,QAApB,CAAf;QACMU,UAAUC,MAAMC,IAAN,CAAWH,OAAOI,QAAlB,CAAhB;MACIC,aAAa,CAAjB;SACOT,gBAAP,CAAwB,aAAxB,EAAuC,MAAM;UACrCU,OAAN,CAAcC,KAAd,GAAsBN,QAAQI,UAAR,EAAoBC,OAApB,CAA4BC,KAAlD;YACQF,UAAR,EAAoBR,SAApB,CAA8BC,GAA9B,CAAkC,MAAlC;iBACa,EAAEO,UAAF,GAAeJ,QAAQO,MAApC;YACQH,UAAR,EAAoBR,SAApB,CAA8BE,MAA9B,CAAqC,MAArC;GAJF;;QAOMU,UAAUd,MAAMJ,aAAN,CAAoB,SAApB,CAAhB;QACMmB,WAAWR,MAAMC,IAAN,CAAWM,QAAQL,QAAnB,CAAjB;MACIO,cAAc,CAAlB;UACQf,gBAAR,CAAyB,aAAzB,EAAwC,MAAM;UACtCU,OAAN,CAAcM,MAAd,GAAuBF,SAASC,WAAT,EAAsBL,OAAtB,CAA8BM,MAArD;aACSD,WAAT,EAAsBd,SAAtB,CAAgCC,GAAhC,CAAoC,MAApC;kBACc,EAAEa,WAAF,GAAgBD,SAASF,MAAvC;aACSG,WAAT,EAAsBd,SAAtB,CAAgCE,MAAhC,CAAuC,MAAvC;GAJF;;QAOMc,QAAQlB,MAAMJ,aAAN,CAAoB,OAApB,CAAd;QACMuB,YAAYD,MAAMtB,aAAN,CAAoB,QAApB,CAAlB;MACIwB,MAAM,EAAV;cACYC,KAAK;;UAETA,CAAN;cACUC,SAAV,GAAsBF,GAAtB;UACMG,SAAS,IAAIC,OAAOC,eAAX,CAA2BD,OAAOrD,QAAP,CAAgBuD,MAA3C,CAAf;WACOC,GAAP,CAAW,GAAX,EAAgBP,GAAhB;WACOQ,MAAP,CAAc,GAAd;WACOC,OAAP,CAAeC,SAAf,CAAyB,EAAzB,EAA6B,EAA7B,EAAiCN,OAAOrD,QAAP,CAAgB4D,QAAhB,GAA2B,GAA3B,GAAiCR,MAAlE;GAPF;iBASe,MAAM;;GAArB;QAGMtB,gBAAN,CAAuB,aAAvB,sBAAsC,aAAY;;UAE1C+B,WAAW,MAAMhD,WAAWwC,OAAOrD,QAAP,CAAgB8D,IAA3B,CAAvB;UACM,IAAIC,GAAJ,CAAQF,QAAR,EAAkBD,QAAlB,CAA2BI,KAA3B,CAAiC,CAAjC,CAAN;cACUf,GAAV;GAJF;CAlDF;;;;ACJA,AACA,AAEA,sBAAe,MAAM;QACbG,SAAS,IAAIC,OAAOC,eAAX,CAA2BD,OAAOrD,QAAP,CAAgBuD,MAA3C,CAAf;QACMU,UAAUzC,SAASC,aAAT,CAAuB,MAAvB,CAAhB;;;QAGMyC;iCAAO,aAAkB;UACzBC,OAAOf,OAAOgB,GAAP,CAAW,GAAX,CAAX;YACMnB,MAAMG,OAAOgB,GAAP,CAAW,GAAX,CAAZ;UACInB,GAAJ,EAAS;eACA,IAAIK,eAAJ,CAAoB,IAAIS,GAAJ,EAAQ,MAAM3C,UAAU,mBAAmB6B,GAA7B,CAAd,GAAiDM,MAArE,EAA6Ea,GAA7E,CAAiF,GAAjF,CAAP;eACOX,MAAP,CAAc,GAAd;eACOD,GAAP,CAAW,GAAX,EAAgB,IAAIF,eAAJ,CAAoB,IAAIS,GAAJ,EAAQ,MAAM3C,UAAU,mBAAmB6B,GAA7B,CAAd,GAAiDM,MAArE,EAA6Ea,GAA7E,CAAiF,GAAjF,CAAhB;eACOV,OAAP,CAAeC,SAAf,CAAyB,EAAzB,EAA6B,EAA7B,EAAiCN,OAAOrD,QAAP,CAAgB4D,QAAhB,GAA2B,GAA3B,GAAiCR,MAAlE;kBACUH,GAAV;;cAEME,SAAR,GAAoBgB,QAClB,cACA,4BADA,GAEA,6EAFA,GAGA,wEAJF;KAVI;;;;;MAAN;;QAiBME,OAAO,YAAY;WAChBb,GAAP,CAAW,GAAX,EAAgBS,QAAQd,SAAxB;WACOO,OAAP,CAAeY,YAAf,CAA4B,EAA5B,EAAgC,EAAhC,EAAoCjB,OAAOrD,QAAP,CAAgB4D,QAAhB,GAA2B,GAA3B,GAAiCR,MAArE;;GAFF;;QAMMmB,QAAQ,YAAY;SACnB,IAAIC,IAAT,IAAiBP,QAAQd,SAAR,CAAkBsB,KAAlB,CAAwB,MAAxB,CAAjB,EAAkD;UAC5CD,IAAJ,EAAU;iBACCD,KAAT,GAAiB,UAAU,KAAV,GAAkBC,KAAKE,OAAL,CAAa,eAAb,EAA8B,EAA9B,CAAnC;;;;GAHN;;QASMC,QAAQ,YAAY;QACpB,CAACV,QAAQd,SAAR,CAAkByB,IAAlB,GAAyBF,OAAzB,CAAiC,MAAjC,EAAyC,EAAzC,CAAL,EAAmD;iBACtC,YAAY;gBAAUC,KAAR;OAAzB,EAA4C,CAA5C;KADF,MAEO;cACGA,KAAR;UACIE,QAAQrD,SAASsD,WAAT,EAAZ;YACMC,kBAAN,CAAyBd,OAAzB;YACMe,QAAN,CAAe,KAAf;UACIC,MAAM5B,OAAO6B,YAAP,EAAV;UACIC,eAAJ;UACIC,QAAJ,CAAaP,KAAb;;GAVJ;;;MAeIQ,WAAW,KAAf;UACQC,OAAR,GAAkB,YAAY;QACxB,CAACD,QAAL,EAAe;iBAEX,YAAY;;;mBAGC,KAAX;OAJJ,EAME,IAAI,IANN;;eASS,IAAX;GAXF;;;WAeSE,SAAT,GAAqB,UAAUC,CAAV,EAAa;YACxBA,EAAEC,OAAV;WACO,CAAL;;;iBAEWC,WAAT,CAAqB,YAArB,EAAmC,KAAnC,EAA0C,KAA1C;UACEC,cAAF;;WAEG,EAAL;;iBACWD,WAAT,CAAqB,YAArB,EAAmC,KAAnC,EAA0C,UAA1C;UACEC,cAAF;;;GATN;;;;;;CApEF;;ACCAnE,SAASoE,kBAAT,GAA8B,YAAY;MACpCpE,SAASqE,UAAT,KAAwB,aAAxB,IAAyCrE,SAASqE,UAAT,KAAwB,UAArE,EAAiF;aACtED,kBAAT,GAA8B,MAAM,EAApC;;;;CAFJ"}