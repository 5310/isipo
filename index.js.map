{"version":3,"file":"index.js","sources":["src/index.js"],"sourcesContent":["document.onreadystatechange = function () {\n  if (document.readyState === 'interactive' || document.readyState === 'complete') {\n    document.onreadystatechange = () => {}\n\n    const params = new window.URLSearchParams(window.location.search)\n    const content = document.querySelector('main')\n\n    // Load content from URL, if any.\n    const load = function () {\n      const t = params.get('t')\n      if (t) content.innerHTML = t\n    }\n    // Save content to the URL.\n    const save = function () {\n      params.set('t', content.innerHTML)\n      window.history.replaceState({}, '', window.location.pathname + '?' + params)\n    }\n    // Update title from content.\n    const title = function () {\n      for (let line of content.innerHTML.split('<br>')) {\n        if (line) {\n          document.title = 'isipo' + ' - ' + line.slice(0, -5).trim()\n          break\n        }\n      }\n    }\n    // Place caret at the end of content.\n    const focus = function () {\n      if (!content.innerHTML.trim().replace('<br>', '')) {\n        setTimeout(function () { content.focus() }, 0)\n      } else {\n        content.focus()\n        let range = document.createRange()\n        range.selectNodeContents(content)\n        range.collapse(false)\n        let sel = window.getSelection()\n        sel.removeAllRanges()\n        sel.addRange(range)\n      }\n    }\n\n    // Hook up save routine.\n    let cooldown = false\n    content.oninput = function () {\n      if (!cooldown) {\n        setTimeout(\n          function () {\n            save()\n            title()\n            cooldown = false\n          },\n          1 * 1000\n        )\n      }\n      cooldown = true\n    }\n\n    // Let tabs be tabs~\n    document.onkeydown = function (e) {\n      if (e.keyCode === 9) {\n        // TODO: Consider indent/outdent for selections with tab/shift+tab.\n        document.execCommand('insertHTML', false, '&#9')\n        e.preventDefault()\n      }\n      if (e.keyCode === 13) {\n        document.execCommand('insertHTML', false, '<br><br>')\n        e.preventDefault()\n      }\n    }\n\n    // Initialize.\n    load()\n    title()\n    focus()\n  }\n}\n"],"names":["document","onreadystatechange","readyState","params","window","URLSearchParams","location","search","content","querySelector","load","t","get","innerHTML","save","set","history","replaceState","pathname","title","line","split","slice","trim","focus","replace","range","createRange","selectNodeContents","collapse","sel","getSelection","removeAllRanges","addRange","cooldown","oninput","onkeydown","e","keyCode","execCommand","preventDefault"],"mappings":"AAAAA,SAASC,kBAAT,GAA8B,YAAY;MACpCD,SAASE,UAAT,KAAwB,aAAxB,IAAyCF,SAASE,UAAT,KAAwB,UAArE,EAAiF;aACtED,kBAAT,GAA8B,MAAM,EAApC;;UAEME,SAAS,IAAIC,OAAOC,eAAX,CAA2BD,OAAOE,QAAP,CAAgBC,MAA3C,CAAf;UACMC,UAAUR,SAASS,aAAT,CAAuB,MAAvB,CAAhB;;;UAGMC,OAAO,YAAY;YACjBC,IAAIR,OAAOS,GAAP,CAAW,GAAX,CAAV;UACID,CAAJ,EAAOH,QAAQK,SAAR,GAAoBF,CAApB;KAFT;;UAKMG,OAAO,YAAY;aAChBC,GAAP,CAAW,GAAX,EAAgBP,QAAQK,SAAxB;aACOG,OAAP,CAAeC,YAAf,CAA4B,EAA5B,EAAgC,EAAhC,EAAoCb,OAAOE,QAAP,CAAgBY,QAAhB,GAA2B,GAA3B,GAAiCf,MAArE;KAFF;;UAKMgB,QAAQ,YAAY;WACnB,IAAIC,IAAT,IAAiBZ,QAAQK,SAAR,CAAkBQ,KAAlB,CAAwB,MAAxB,CAAjB,EAAkD;YAC5CD,IAAJ,EAAU;mBACCD,KAAT,GAAiB,UAAU,KAAV,GAAkBC,KAAKE,KAAL,CAAW,CAAX,EAAc,CAAC,CAAf,EAAkBC,IAAlB,EAAnC;;;;KAHN;;UASMC,QAAQ,YAAY;UACpB,CAAChB,QAAQK,SAAR,CAAkBU,IAAlB,GAAyBE,OAAzB,CAAiC,MAAjC,EAAyC,EAAzC,CAAL,EAAmD;mBACtC,YAAY;kBAAUD,KAAR;SAAzB,EAA4C,CAA5C;OADF,MAEO;gBACGA,KAAR;YACIE,QAAQ1B,SAAS2B,WAAT,EAAZ;cACMC,kBAAN,CAAyBpB,OAAzB;cACMqB,QAAN,CAAe,KAAf;YACIC,MAAM1B,OAAO2B,YAAP,EAAV;YACIC,eAAJ;YACIC,QAAJ,CAAaP,KAAb;;KAVJ;;;QAeIQ,WAAW,KAAf;YACQC,OAAR,GAAkB,YAAY;UACxB,CAACD,QAAL,EAAe;mBAEX,YAAY;;;qBAGC,KAAX;SAJJ,EAME,IAAI,IANN;;iBASS,IAAX;KAXF;;;aAeSE,SAAT,GAAqB,UAAUC,CAAV,EAAa;UAC5BA,EAAEC,OAAF,KAAc,CAAlB,EAAqB;;iBAEVC,WAAT,CAAqB,YAArB,EAAmC,KAAnC,EAA0C,KAA1C;UACEC,cAAF;;UAEEH,EAAEC,OAAF,KAAc,EAAlB,EAAsB;iBACXC,WAAT,CAAqB,YAArB,EAAmC,KAAnC,EAA0C,UAA1C;UACEC,cAAF;;KARJ;;;;;;;CA1DJ"}